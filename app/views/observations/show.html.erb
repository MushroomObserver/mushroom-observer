<% # bs4
  # TODO: replace with full width carousel - details, then columns
  # The move is to make the whole top thing a card:
  #    carousel header details footer
  @owner_naming = owner_naming_line(@observation) # must before show_obs_title
  @title = show_obs_title(obs: @observation, owner_naming: @owner_naming)
  @tabsets = show_observation_tabset(obs: @observation, user: @user,
                                     mappable: @mappable)
  @container = :double

  show_map   = @user ? @user.thumbnail_maps : !session[:hide_thumbnail_maps]
  show_lists = @user && @observation.species_lists.any?
  show_links = @user && (@observation.external_links.any? || @new_sites.any?)

  obs_locals = { observation: @observation }
%>

<div class="card mb-4">

  <div class="row no-gutters">
    <div class="col-md-4">
      <div class="h-100 d-flex flex-column">
        <div class="card-header pr-md-4">
          <%= tag.h6("#{:show_observation_header.t} #{@observation.id}",
                     class: "mb-0") %>
        </div>

        <div class="card-body list-indented pr-md-4" id="observation_details">
          <%= render(partial: "observations/show/observation",
                    locals: obs_locals) %>
        </div>

        <div class="card-footer pr-md-4">
          <%= show_object_footer(@observation) %>
        </div>
      </div>
    </div><!--.col-->

    <div class="col-md-8">
      <%= render(partial: "shared/images/carousel",
                locals: { object: @observation }) %>
    </div><!--.col-->
  </div><!--.row-->

</div><!--.card-->

<div class="row">

  <div class="col-md-8 col-xl-7">
    <% if @user %>
      <%= render(partial: "observations/show/namings", locals: obs_locals) %>
    <% end %>

    <%= render(partial: "comments/comments_for_object",
               locals: { object: @observation, controls: true, limit: nil }) %>

    <%= @observation.source_credit.tpl if @observation.source_noteworthy? %>
  </div>

  <div class="col-md-4 col-xl-5">
    <% if @user %>
      <%= panel_block(id: "observation_name_info", class: "mb-3",
                      inner_class: "list-indented small") do
        render(partial: "observations/show/name_info", locals: obs_locals)
      end %>

      <% if show_lists %>
        <%= panel_with_outer_heading(heading: :show_lists_header.t,
                                     id: "observation_species_lists",
                                     inner_class: "p-0") do
          render(partial: "observations/show/species_lists", locals: obs_locals)
        end %>
      <% end %>

      <% if show_links %>
        <%= panel_with_outer_heading(heading: :EXTERNAL_LINKS.t,
                                     id: "observation_links",
                                     inner_class: "p-0") do
          render(partial: "observations/show/links", locals: obs_locals)
        end %>
      <% end %>
    <% end %>

    <% if show_map %>
      <%= render(partial: "observations/show/thumbnail_map",
                 locals: obs_locals) %>
    <% end %>

    <%# render(partial: "observations/show/images", locals: obs_locals) %>
  </div>

</div><!--.row-->

