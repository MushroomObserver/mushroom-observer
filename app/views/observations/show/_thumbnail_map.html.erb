<%
n, s, e, w, lat, long, x, y = observation_map_coordinates(obs: obs)
map_url = map_observation_path(id: obs.id, q: get_query_param)
%>

<%= tag.div(class: "card", id: "observation_thumbnail_map") do %>

  <%= tag.div(class: "card-header d-flex justify-content-between") do
    concat(tag.h6(:MAP.t))
    concat(
      icon_link_with_query(
        :show_observation_hide_map.t,
        javascript_hide_thumbnail_map_path(id: obs.id), icon: :hide
      )
    )
  end %>

  <%= tag.div(class: "thumbnail-map-container card-img-bottom") do %>

    <%= tag.div(class: "thumbnail-buttons") do
      concat(tag.div("", class: "plus-button"))
      concat(tag.div("", class: "minus-button"))
    end %>

    <%= tag.div(class: "thumbnail-map") do %>

      <%= if obs.location
        if w < e && s > n
          tag.div(
            "", class: "thumbnail-map-box",
            style: "left:#{w}%; top:#{n}%; width:#{e-w}%; height:#{s-n}%"
          )
        elsif w > e && s > n
          tag.div(
            "", class: "thumbnail-map-box",
            style: "left:0%; top:#{n}%; width:#{e}%; height:#{s-n}%"
          ) +
          tag.div(
            "", class: "thumbnail-map-box",
            style: "left:#{w}%; top:#{n}%; width:#{100-w}%; height:#{s-n}%"
          )
        end
      end %>

      <%= if lat && long
        tag.div("", class: "pin-offset") do
          tag.div("", class: "red-pin", style: "left:#{x}%; bottom:#{100-y}%")
        end
      end %>

      <%= image_tag(
        "globe.jpg", class: "w-100", id: "globe_image",
        data: { globe_large_url: "#{image_url("globe_large.jpg")}" }
      ) %>

    <% end %>
  <% end %>

<% end %>

<%= if lat && long
  javascript_tag %{
    var THUMBNAIL_MAP_ON   = true;
    var THUMBNAIL_MAP_X    = #{x};
    var THUMBNAIL_MAP_Y    = #{y};
    var THUMBNAIL_MAP_LINK = "#{map_url}";
  }
end %>
