<% @location.force_valid_lat_longs! %>
<% map_args = local_assigns.except(:location, :action, :button).
              merge({ editable: true })%>

<%= form_with(model: @location, url: action, id: "location_form") do |f| %>

  <% if !@location.locked || in_admin_mode? %>

    <%= render(partial: "shared/form_location_feedback",
               locals: { button: button.l} ) %>

    <%= tag.div(class: "row", data: { controller: "map" }) do %>
      <%= tag.div(class: "col-md-8 col-lg-6") do %>

        <%= submit_button(form: f, button: button.l, center: true) %>

        <%= if in_admin_mode?
          check_box_with_label(form: f, field: :locked, class: "mt-3",
                               label: :form_locations_locked.t)
        end %>

        <%= render(partial: "locations/form/display_name_field",
                   locals: { f: f }) %>

        <%= render(partial: "locations/form/lat_long_alt_fields",
                   locals: { f: f }) %>

        <%= tag.div(class: "position-relative") do
          tag.div(class: "ab-right") do
            tag.button(
              :form_locations_find_on_map.t,
              type: "button", class: "btn btn-default",
              data: { map_target: "findOnMap", action: "map#findOnMap"}
            )
          end
        end %>

      <% end %>

      <%= tag.div(class: "col-md-4 col-lg-6 mb-3 mt-3") do
        make_map([@location], **map_args.merge({ controller: nil }))
      end %><!--.col-md-4 col-lg-6-->
    <% end %><!--.row-->

  <% else %>

    <%= render(partial: "locations/form/show_locked", locals: { f: f }) %>

  <% end %>

  <%= render(partial: "locations/form/notes_field", locals: { f: f }) %>

<% end %>
