<%
options = [
  [:COMMENTS.l, :comment],
  [:GLOSSARY.l, :glossary_term],
  [:HERBARIA.l, :herbarium],
  # Temporarily disabled for performance reasons. 2021-09-12 JDC
  # [:IMAGES.l, :image],
  [:LOCATIONS.l, :location],
  [:NAMES.l, :name],
  [:OBSERVATIONS.l, :observation],
  [:PROJECTS.l, :project],
  [:SPECIES_LISTS.l, :species_list],
  [:HERBARIUM_RECORDS.l, :herbarium_record],
  [:USERS.l, :user],
  [:app_search_google.l, :google],
].sort

@timer_end ||= Time.zone.now
secs = "%.2f" % (@timer_end.to_f - @timer_start.to_f)
timer_text = "(#{ :app_index_timer.t(seconds: secs,
                                     num: @num_results.to_i) })"
timer = content_tag(:div, timer_text, class: "text-nowrap", id: "timer")
adv_search = link_to(
  content_tag(:span, :app_advanced_search.l, class: "text-nowrap"),
  search_advanced_path
)
search_types = options_for_select(options, session[:search_type] ||
                                           :observation)

# Fields have attributes nested under search via fields_for, eg search[:type]
%>

<%= form_with(url: search_pattern_path, method: :get, scope: :search,
              class: "form-inline px-0",
              id: "pattern_search_form") do |f|

  content_tag(:div, class: "input-group") do
    concat(f.text_field(:pattern, { value: session[:pattern],
                                    class: "form-control",
                                    style: "flex-grow: 2;",
                                    placeholder: :app_find.t }))
    concat(f.select(:type, search_types, { },
                    { class: "custom-select" }))
    concat(content_tag(:div, class: "input-group-append") do
             button_tag(type: :submit, value: :app_search.l,
                        class: "btn btn-outline-secondary",
                        aria: { label: :app_search.l }) do
               icon("fa-solid", "magnifying-glass")
             end
           end)
  end
end %>

<%= content_tag(:div, class: "navbar-text mx-2 text-nowrap") do
  link_to(content_tag(:span, :search_bar_help.t),
          info_search_bar_help_path)
end %>

<% if @timer_start %>
  <%= content_tag(:div, class: "navbar-text mx-2 d-none d-md-block smaller") do
    [timer, adv_search].safe_join
  end %>
<% else %>
  <%= content_tag(:div, adv_search,
                  class: "navbar-text mx-2 d-none d-md-block") %>
<% end %>

<%= content_tag(:div, class: "d-block d-md-none") do
  concat(timer) if @timer_start
  concat(adv_search)
end %>
