<%# locals: (form: nil, search: nil, heading: nil, sections: nil) -%>
<%#
  Builds a single filter group, or panel, for a search form. The panel's
  field groups are defined in the controller, along with the field methods.
  Sections can be shown or collapsed.
  If sections["collapsed"] is present, part of the panel will be collapsed.
%>
<%
  shown = search_panel_shown(form:, search:, sections:)
  collapsed = search_panel_collapsed(form:, search:, sections:)
  has_collapse = sections[:collapsed].present?
  collapse_id = has_collapse ? "#{controller.search_type}_#{heading}" : nil
  open = has_collapse ? search_panel_open?(search:, sections:) : false
%>

<%= render(Components::Panel.new) do |panel| %>
  <% if has_collapse %>
    <%= panel.render(Components::PanelCollapseHeading.new(
      target: collapse_id,
      open:,
      collapse_message: :MORE.l
    ) { :"search_term_group_#{heading}".l }) %>
    <%= panel.render(Components::PanelBody.new { shown }) %>
    <%= panel.render(Components::PanelCollapseBody.new(
      id: collapse_id,
      open:
    ) do %>
      <%= panel.render(Components::PanelBody.new { collapsed }) %>
    <% end) %>
  <% else %>
    <%= panel.render(Components::PanelHeading.new { :"search_term_group_#{heading}".l }) %>
    <%= panel.render(Components::PanelBody.new { shown }) %>
  <% end %>
<% end %>
