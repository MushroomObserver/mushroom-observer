<%# locals: (form: nil, search: nil, heading: nil, sections: nil) -%>
<%#
  Builds a single filter group, or panel, for a search form. The panel's
  field groups are defined in the controller, along with the field methods.
  Sections can be shown or collapsed.
  If sections["collapsed"] is present, part of the panel will be collapsed.
%>
<%
  shown = search_panel_shown(form:, search:, sections:)
  collapsed = search_panel_collapsed(form:, search:, sections:)
  collapsible = sections[:collapsed].present?
  collapse_id = collapsible ? "#{controller.search_type}_#{heading}" : nil
  expanded = collapsible ? search_panel_open?(search:, sections:) : false
%>

<%= render(Components::Panel.new(
      collapsible:, collapse_id:, expanded:
    )) do |panel| %>
  <%= panel.with_heading do %>
    <%= :"search_term_group_#{heading}".l %>
  <% end %>
  <%= panel.with_body do %>
    <%= shown %>
  <% end %>
  <% if collapsible %>
    <%= panel.with_body(collapse: true) do %>
      <%= collapsed %>
    <% end %>
  <% end %>
<% end %>
