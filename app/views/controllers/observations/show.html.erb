<%
# owner_naming must be defined before show_obs_page_title.
# nil if not user's pref, or namings are identical.
show_owner_naming = owner_naming_line(
  name: @observation.name, owner_name: @owner_name, user: @user
)
show_title = observation_show_title(
  obs: @observation, show_owner_naming:, user: @user
)
add_show_title(show_title, @observation)
add_owner_naming(@owner_naming)
if @user
  add_pager_for(@observation)
  add_interest_icons(@user, @observation)
  add_edit_icons(@observation)
end

container_class(:double)
column_classes(:eight_four)

show_map   = @user ? @user.thumbnail_maps : !session[:hide_thumbnail_maps]
show_lists = @user # && @observation.species_lists.any?

obs_locals = { obs: @observation, consensus: @consensus, user: @user }
carousel_locals = {
  object: @observation, images: @images,
  html_id: "observation_images", user: @user,
  title: :IMAGES.t, links: observation_show_image_links(obs: @observation)
}
%>

<%= tag.div(class: "row") do %>
  <%= tag.div(class: yield(:left_columns)) do %>
    <%= tag.div(class: "panel panel-default") do
      render(partial: "shared/carousel", locals: carousel_locals)
    end %>
  <% end %>

  <%= tag.div(class: yield(:right_columns)) do %>
    <%= render(partial: "observations/show/observation_details",
               locals: obs_locals.merge(sites: @other_sites)) %>
    <% if @user %>
      <%= render(partial: "observations/show/name_info", locals: obs_locals) %>

      <% if show_lists %>
        <%= render(partial: "observations/show/species_lists",
                   locals: obs_locals) %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
<!--.row-->

<%= tag.div(class: "row") do %>
  <%= tag.div(class: yield(:left_columns)) do %>
    <% if @user %>
      <%= render(partial: "observations/show/namings", locals: obs_locals) %>
    <% end %>

    <%= render(partial: "comments/comments_for_object",
               locals: { object: @observation, comments: @comments,
                         controls: @user, limit: nil }) %>

    <%= @observation.source_credit.tpl if @observation.source_noteworthy? %>
  <% end %>

  <% if @user %>
    <%= tag.div(class: yield(:right_columns)) do %>
      <% if show_map %>
        <%= render(partial: "observations/show/thumbnail_map",
                   locals: obs_locals) %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
<!--.row-->

<% if @user %>
  <%= show_object_footer(@user, @observation) %>
<% end %>

