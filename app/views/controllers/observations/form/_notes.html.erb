<%# Notes section of create_observation form %>

<%
# Users may have custom notes "parts". This prints a single large textarea and
# textile help block if there's only one notes part. Otherwise, it prints
# smaller textareas and a general textile help link.

help = general_help = other = nil
if @observation.form_notes_parts(@user) == [Observation.other_notes_part]
  help = [tag.p(:form_observations_notes_help.t),
          tag.p(:shared_textile_help.l)].safe_join
  other = true
  rows = 10
else
  general_help = tag.p do
      [
        tag.strong("#{:NOTES.t}:", class: "mr-3"),
        collapse_info_trigger("notes_help"),
        collapse_help_block(nil, :shared_textile_help.l, id: "notes_help")
      ].safe_join
    end
  rows = 1
end
%>
<!-- NOTES -->
<%= tag.div(class: "mt-3", id: "observation_notes") do
  tag.div(class: "row") do
    tag.div(class: "col-xs-12 col-sm-6") do %>
      <%= general_help %>
      <%= f.fields_for(:notes) do |f_n| %>
        <% @observation.form_notes_parts(@user).each do |part| %>
          <%= text_area_with_label(
                form: f_n, rows:, help:,
                label: other ? "#{:NOTES.t}:" : "#{strip_tags(part.tl)}:",
                field: @observation.notes_normalized_key(part),
                value: @observation.notes_part_value(part)
              ) %>
        <% end # each do part %>
      <% end # f.fields_for(:notes) %>
    <% end
  end
end %><!--#observation_notes-->
<!-- /NOTES -->
