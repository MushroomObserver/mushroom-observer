<!--top_nav-->
<%
container_classes = %w[
  container-fluid px-0 px-sm-3 d-flex flex-row align-items-center
]
top_nav_classes = class_names(container_classes, "justify-content-between")
search_nav_classes = class_names(container_classes, "justify-content-center")
left_classes = class_names(%w[
  d-flex flex-row align-items-center flex-grow-1 navbar_left
])
right_classes = class_names(%w[
  d-flex flex-row align-items-center justify-content-end navbar_right
])
identify_page = controller.controller_name == "identify"
nav_title = if action_name == "index"
              rubric
            else
              nav_index_link(rubric, controller)
            end
%>

<%= tag.nav(class: "navbar navbar-default hidden-print mb-2",
            id: "top_nav") do %>

  <%= tag.div(class: top_nav_classes) do %>

    <%# left side %>
    <%= tag.div(class: left_classes) do %>
      <%= left_nav_toggle %>
      <%= tag.h4(class: "font-weight-bold mr-4 mr-lg-5") do
        [
          nav_title,
          nav_create(@user, controller),
          nav_scan_qr_code(@user, controller)
        ].safe_join(" ")
      end %>
      <%= yield(:sorter) if(content_for?(:sorter)) %>
    <% end %>

    <%# right side %>
    <%= tag.div(class: right_classes) do %>
      <%= search_nav_toggle %>
      <%= tag.ul(class: "nav navbar-nav navbar-right hidden-xs mr-0") do %>
        <%= yield(:context_nav) if content_for?(:context_nav) %>
        <%= render(partial: "application/top_nav/user_nav") if !@user.nil? %>
      <% end %>
      <%= render(partial: "application/top_nav/login") if @user.nil? %>
    <% end %>

  <% end %>

  <%= tag.div(class: search_nav_classes) do %>
    <%= tag.div(class: "collapse w-100", id: "search_nav") do %>
      <% if identify_page %>
        <%= render(partial: "observations/identify/form_identify_filter") %>
      <% else %>
        <%= render(partial: "application/top_nav/search_form") %>
      <% end %>
    <% end %>
  <% end %>

<% end %>
<!--/top_nav-->
