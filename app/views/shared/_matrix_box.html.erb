<%
# Requires local variable object: RssLog, Observation, Image, etc. instance.
presenter = MatrixBoxPresenter.new(object, @view)

if presenter

  link_method ||= :get
  identify ||= false
  columns ||= "col-12 col-sm-6 col-lg-4 col-xl-3" # maybe passed as a local
  object_id = object&.id.present? ? object.id : "no_ID"
  # presenter.image_data includes context: :matrix_box where appropriate
  thumb_locals = local_assigns.
                  except(:columns, :object, :object_counter, :object_iteration).
                  merge(presenter.image_data || {})
  h_element = presenter.image_data ? :h5 : :h3 # bigger heading if no image
  link_heading = content_tag(:small, "(#{object_id})",
                              class: "rss-id float-right") +
                 content_tag(:span, presenter.name, class: "rss-name")
  %>

  <%= matrix_box(columns: columns, id: object_id) do %>
    <div class="card bg-secondary">

      <%= if presenter.image_data
        content_tag(:div, class: "thumbnail-container card-img-top") do
          render(partial: "shared/image_thumbnail", locals: thumb_locals)
        end
      end %>

      <div class="card-body rss-box-details">

        <div class="rss-what">
          <%= content_tag(h_element, class: "mt-0 rss-heading") do
                link_with_query(link_heading, presenter.what.show_link_args)
              end %>
          <%= matrix_box_vote_or_propose_ui(identify, object) %>
        </div><!-- .rss-what -->

        <% if presenter.place_name %>
          <div class="rss-where">
            <%= content_tag(:small) do
              location_link(presenter.place_name, presenter.where)
            end %>
          </div><!-- .rss-where -->
        <% end %>

        <% unless presenter.when.blank? %>
          <div class="rss-what">
            <%= content_tag(:small, class: "text-truncate") do
              concat(content_tag(:span, presenter.when, class: "rss-when"))
              concat(": ")
              concat(user_link(presenter.who, nil, class: "rss-who"))
            end %>
          </div><!-- .rss-when -->
        <% end %>

      </div><!-- .card-body -->

      <%= matrix_box_log_footer(presenter) %>

      <%= matrix_box_identify_footer(identify, object_id) %>

    </div><!-- .panel -->
  <% end %><!-- .matrix-box -->
<% end %>
