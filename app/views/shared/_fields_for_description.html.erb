<%
  desc       = @description
  type       = desc.source_type
  new_record = desc.new_record?
  admin      = new_record || desc.is_admin?(@user)
  author     = new_record || desc.author?(@user)
  owner      = desc.user == @user
  root       = in_admin_mode?
%>

<% if new_record || admin || author || owner || root %>

  <div class="form-group">
    <%= form.label(:source, :form_description_source.t + ":") %>

    <% need_help = false
    if root %>
      <%= form.select(:source_type, [
        [:form_description_source_public.l,  "public"],
        [:form_description_source_foreign.l, "foreign"],
        [:form_description_source_project.l, "project"],
        [:form_description_source_source.l,  "source"],
        [:form_description_source_user.l,    "user"],
      ], {}, { class: "form-control" }) %>
    <% elsif new_record && ["public", "source", "user"].include?(type) %>
      <% need_help = true %>
      <%= form.select(:source_type, [
        [:form_description_source_public.l, "public"],
        [:form_description_source_source.l, "source"],
        [:form_description_source_user.l,   "user"],
      ], {}, { class: "form-control" }) %>
    <% else %>
      <%= form.hidden_field(:source_type, value: type) %>
      <%= :"form_description_source_#{type}".l %>
    <% end %>

    <% if !root && ["foreign", "project"].include?(type) %>
      <%= form.hidden_field(:source_name) %>
      <%= @description.source_name.t %>
    <% else %>
      <%= form.text_field(:source_name, class: "form-control") %>
    <% end %>
    <%= form.hidden_field(:project_id) %>

    <% if need_help %>
      <%= content_tag(:div, :form_description_source_help.tpl,
                      class: "help-block") %>
    <% end %>
  </div>

  <% disabled = ["public", "foreign"].include?(type) && !root &&
                                                        !new_record %>
  <div class="form-group">
    <%= content_tag(:b, "#{:form_description_permissions.t}:") %>
    <%= check_box_with_label(form: form, field: :public_write,
                             disabled: disabled,
                             text: :form_description_public_writable.t) %>
    <%= check_box_with_label(form: form, field: :public, disabled: disabled,
                             text: :form_description_public_readable.t) %>
    <%= content_tag(:p, :form_description_permissions_help.t,
                    class:"help-block") %>
  </div>

  <div class="form-group">
    <%= form.label(:license_id, :License.t + ":") %>
    <%= form.select(:license_id, @licenses, {}, { class: "form-control" }) %>
    <%= content_tag(:p, :form_description_license_help.t,
                    class:"help-block") %>
  </div>

<% end %>
